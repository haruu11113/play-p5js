# Shader-Tyoimaru

滑らかな曲線を持つ動的な3Dオブジェクトを表示するWebGLシェーダープロジェクト。

## 概要

このプロジェクトは、p5.jsとWebGLシェーダーを使用して、滑らかに変形する3Dオブジェクトを生成します。複数のノイズ関数と高度な補間技術を組み合わせることで、有機的で流動的な形状を作り出しています。

## 特徴

- 高解像度の球体メッシュ（96セグメント、調整可能）
- 複数のノイズレイヤーを組み合わせた滑らかな変形
- 時間経過による動的な形状変化
- 高次多項式による滑らかな補間
- インタラクティブな操作（マウスによる回転、キーボードショートカット）
- 美しいグラデーションカラーとエッジハイライト
- リアルタイム統計情報表示（表示/非表示の切り替え可能）
- カスタマイズ可能なUI表示設定

## 技術的詳細

### 頂点シェーダー（normal.vert）

頂点シェーダーは以下の技術を使用して滑らかな曲線を生成しています：

1. **高度なノイズ関数**：
   - 五次エルミート曲線による超滑らかな補間
   - 複数の平面からのサンプリングによる3Dノイズ
   - 5オクターブのフラクタルノイズ（FBM）

2. **形状変形技術**：
   - 滑らかな半径変調
   - 複数の正弦波の組み合わせによる二次的な変形
   - 高次多項式による方向性のある膨らみ

3. **法線計算**：
   - 微分法に基づく精密な法線ベクトル計算
   - 接線ベクトルを用いた正確な法線推定

### フラグメントシェーダー（normal.frag）

フラグメントシェーダーは以下の技術を使用して美しい色彩効果を生成しています：

1. **色彩計算**：
   - HSVカラーモデルによる直感的な色彩制御
   - 法線ベクトルに基づくグラデーション
   - 時間変化するノイズによる色相の変調

2. **エッジ検出と強調**：
   - 法線ベクトルの変化に基づくエッジ検出
   - エッジ部分の彩度と明度の強調

3. **時間効果**：
   - 脈動効果による微妙な色彩変化
   - 時間に基づく色相の周期的変化

## 操作方法

- **マウスドラッグ**：オブジェクトを回転
- **スペースキー**：自動回転のオン/オフを切り替え
- **Rキー**：回転をリセット
- **+/-キー**：球体の詳細度（頂点数）を調整
- **Iキー**：操作方法パネルの表示/非表示を切り替え
- **Sキー**：統計情報パネルの表示/非表示を切り替え

## UI表示設定

プログラム内の設定パラメータを変更することで、初期表示状態をカスタマイズできます：

```javascript
// UI表示設定
let show_instructions = true;  // 操作方法の表示フラグ
let show_stats = true;         // 統計情報の表示フラグ
```

これらのパラメータを変更することで、アプリケーション起動時のUI要素の表示/非表示を制御できます。実行中は、キーボードショートカット（IキーとSキー）を使用して動的に切り替えることも可能です。

## 実行方法

1. ローカルサーバーを起動（例：`python -m http.server`）
2. ブラウザで`http://localhost:8000/shader-tyoimaru/`にアクセス

## 依存関係

- p5.js（バージョン1.9.4以上推奨）
- WebGL対応ブラウザ

## コード構成

- `index.html` - HTMLエントリーポイント
- `main.js` - p5.jsのメインスクリプト
- `normal.vert` - 頂点シェーダー
- `normal.frag` - フラグメントシェーダー
- `README.md` - プロジェクト説明

## リファクタリングについて

このプロジェクトは以下の点でリファクタリングされています：

1. **モジュール化**：
   - 関連する機能を関数にまとめる
   - 定数の分離と命名
   - 論理的なセクション分け

2. **コード構造の改善**：
   - 明確なコメントとJSDoc形式のドキュメント
   - 一貫した命名規則
   - 処理の流れを明確にするセクション分け

3. **パフォーマンス最適化**：
   - 計算の重複を避ける
   - 効率的なアルゴリズム
   - 適切な関数分割

4. **拡張性**：
   - パラメータの調整が容易
   - 新機能の追加が簡単
   - 明確な関数インターフェース

5. **ユーザビリティ**：
   - インタラクティブな操作の追加
   - 操作説明の表示（表示/非表示の切り替え可能）
   - リアルタイム統計情報の表示（表示/非表示の切り替え可能）
   - UI要素の表示/非表示を制御するパラメータの追加

## パフォーマンスに関する注意

高詳細度の設定（144以上）では、低スペックのデバイスでパフォーマンスが低下する可能性があります。その場合は、「-」キーを押して詳細度を下げてください。

## 今後の拡張可能性

- カラーパレットの切り替え機能
- 形状変形パラメータの動的調整
- 複数のオブジェクトの表示
- テクスチャマッピングの追加
- VR/AR対応
- さらなるUI設定のカスタマイズオプション
